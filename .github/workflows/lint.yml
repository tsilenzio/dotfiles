name: Lint

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          severity: warning
          ignore_names: ".zsh* zshrc* zshenv* zprofile* zlogin* zlogout* *.zsh"

  zsh-syntax:
    name: Zsh Syntax
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install Zsh
        run: sudo apt-get install -y zsh

      - name: Check Zsh syntax
        run: |
          shopt -s globstar nullglob dotglob
          files=()
          while IFS= read -r -d '' file; do
            files+=("$file")
          done < <(find . -type f \( -name ".zsh*" -o -name "zshrc*" -o -name "zshenv*" -o -name "zprofile*" -o -name "zlogin*" -o -name "zlogout*" -o -name "*.zsh" \) -print0)
          for file in "${files[@]}"; do
            echo "Checking $file..."
            zsh -n "$file"
          done
